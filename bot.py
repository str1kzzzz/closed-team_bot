import os
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, BotCommand
from aiogram.webhook.aiohttp_server import SimpleRequestHandler, setup_application
from aiohttp import web
import ssl

# –ó–∞–º–µ–Ω–∏—Ç–µ 'YOUR_BOT_TOKEN' –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ @BotFather
BOT_TOKEN = os.getenv('BOT_TOKEN') or '8498988807:AAEnH5BNh_WRcseQwgQZHtWjlTdo'

# URL –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
IMAGE_URL = "https://ibb.co/prdQqpdy"  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à URL –∫–∞—Ä—Ç–∏–Ω–∫–∏

# –î–ª—è Render
WEBHOOK_HOST = os.getenv('RENDER_EXTERNAL_URL')  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Render
WEBHOOK_PATH = '/webhook'
WEBHOOK_URL = f"{WEBHOOK_HOST}{WEBHOOK_PATH}"

bot = Bot(token=BOT_TOKEN)
dp = Dispatcher()

# Inline keyboard —Å 4 –∫–Ω–æ–ø–∫–∞–º–∏
inline_kb = InlineKeyboardMarkup(inline_keyboard=[
    [InlineKeyboardButton(text="–û—Ç–∑—ã–≤—ã", url="https://t.me/+kO5zIxILayw0MjMy")],
    [InlineKeyboardButton(text="–¢–∞—Ä–∏—Ñ—ã", callback_data="msg1")],
    [InlineKeyboardButton(text="–ö—É–ø–∏—Ç—å", callback_data="msg2")],
    [InlineKeyboardButton(text="–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã", callback_data="msg3")],
])

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start
@dp.message(Command("start"))
async def start(message: types.Message):
    await message.answer("–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é:", reply_markup=inline_kb)

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º
@dp.callback_query(lambda c: c.data in ["msg1", "msg2", "msg3"])
async def process_callback(callback: types.CallbackQuery):
    if callback.data == "msg1":
        text = "üí∞ –¢–∞—Ä–∏—Ñ—ã –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ\n\n1 –º–µ—Å—è—Ü ‚Äî 1000‚ÇΩ\n6 –º–µ—Å—è—Ü–µ–≤ ‚Äî 5000‚ÇΩ\n12 –º–µ—Å—è—Ü–µ–≤ ‚Äî 10000‚ÇΩ\n–ù–∞–≤—Å–µ–≥–¥–∞ ‚Äî 15000‚ÇΩ\n\n–í—ã–±–∏—Ä–∞–π —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –æ–±—É—á–µ–Ω–∏—é!"
    elif callback.data == "msg2":
        text = "üí≥ –ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ?\n\n–í—ã–±–µ—Ä–∏ —É–¥–æ–±–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É –≤–∏–¥–µ–æ–º–µ–π–∫–µ—Ä–æ–≤!\n–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Ç—ã –ø–æ–ª—É—á–∏—à—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, –æ–±—É—á–∞—é—â–∏–º –º–æ–¥—É–ª—è–º –∏ —á–∞—Ç—É —Å –∫—É—Ä–∞—Ç–æ—Ä–∞–º–∏.\n\nüì© –î–ª—è –ø–æ–∫—É–ø–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–±—É—á–µ–Ω–∏—é ‚Äî –ø–∏—à–∏ —Å—é–¥–∞:\nüëâ @Neckfee\n–ù–∞—á–Ω–∏ –ø—É—Ç—å –≤ –≤–∏–¥–µ–æ–º–æ–Ω—Ç–∞–∂ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è üé¨"
    elif callback.data == "msg3":
        text = "üí° –ö–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ?\n–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤ —É–¥–æ–±–Ω–æ–º –æ–Ω–ª–∞–π–Ω-—Ñ–æ—Ä–º–∞—Ç–µ ‚Äî —á–µ—Ä–µ–∑ –≤–∏–¥–µ–æ—É—Ä–æ–∫–∏, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ —Ä–∞–∑–±–æ—Ä—ã. –¢—ã –º–æ–∂–µ—à—å —É—á–∏—Ç—å—Å—è –≤ —Å–≤–æ—ë–º —Ç–µ–º–ø–µ –∏ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ –≤ —á–∞—Ç–µ.\n\n\nüöÄ –ö–æ–≥–¥–∞ —è –≤–æ–∑—å–º—É –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞?\n–í—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç–∏. –í —Å—Ä–µ–¥–Ω–µ–º —É—á–µ–Ω–∏–∫–∏ –±–µ—Ä—É—Ç –ø–µ—Ä–≤—ã–µ –∑–∞–∫–∞–∑—ã —É–∂–µ —á–µ—Ä–µ–∑ 3‚Äì6 –Ω–µ–¥–µ–ª—å, –ø–æ—Å–ª–µ –æ—Å–≤–æ–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞ Kwork.\n\n\n‚è∞ –°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —É–¥–µ–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –æ–±—É—á–µ–Ω–∏—é?\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–¥–µ–ª—è—Ç—å —Ö–æ—Ç—è –±—ã 1‚Äì2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å. –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.\n\n\nüß© –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —è –Ω–µ –ø–æ–Ω–∏–º–∞—é –º–∞—Ç–µ—Ä–∏–∞–ª?\n–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π! –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –≤ —á–∞—Ç–µ ‚Äî —Ç–µ–±–µ –ø–æ–º–æ–≥—É—Ç –∫—É—Ä–∞—Ç–æ—Ä—ã –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞. –ú—ã —Ä–∞–∑–±–∏—Ä–∞–µ–º —Å–ª–æ–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –Ω–∞ –ø–æ–Ω—è—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö.\n\nüí∏ –ö–∞–∫–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –±—É–¥–µ—Ç –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –≤ Closed Team?\n–î–æ—Ö–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.\n–í —Å—Ä–µ–¥–Ω–µ–º –Ω–∞—à–∏ –≤—ã–ø—É—Å–∫–Ω–∏–∫–∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—Ç 50 000 –¥–æ 100 000‚ÇΩ –≤ –º–µ—Å—è—Ü –Ω–∞ —Ñ—Ä–∏–ª–∞–Ω—Å–µ, –≤—ã–ø–æ–ª–Ω—è—è –∑–∞–∫–∞–∑—ã –ø–æ –≤–∏–¥–µ–æ–º–æ–Ω—Ç–∞–∂—É, –¥–∏–∑–∞–π–Ω—É –∏ –∞–Ω–∏–º–∞—Ü–∏–∏.\n–ü—Ä–∏ —Ö–æ—Ä–æ—à–µ–º –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö –¥–æ—Ö–æ–¥ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 150 000‚ÇΩ –≤ –º–µ—Å—è—Ü."
    restart_button = InlineKeyboardMarkup(inline_keyboard=[[InlineKeyboardButton(text="–ù–∞–∑–∞–¥", callback_data="restart")]])
    await callback.message.answer_photo(IMAGE_URL, caption=text, reply_markup=restart_button)
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –¥–ª—è —Ä–µ—Å—Ç–∞—Ä—Ç–∞
@dp.callback_query(lambda c: c.data == "restart")
async def restart_callback(callback: types.CallbackQuery):
    await callback.message.edit_text("–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏—é:", reply_markup=inline_kb)
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –º–µ–Ω—é
@dp.message(Command("questions"))
async def questions(message: types.Message):
    text = "üí° –ö–∞–∫ –±—É–¥–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ?\n–û–±—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤ —É–¥–æ–±–Ω–æ–º –æ–Ω–ª–∞–π–Ω-—Ñ–æ—Ä–º–∞—Ç–µ ‚Äî —á–µ—Ä–µ–∑ –≤–∏–¥–µ–æ—É—Ä–æ–∫–∏, –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ —Ä–∞–∑–±–æ—Ä—ã. –¢—ã –º–æ–∂–µ—à—å —É—á–∏—Ç—å—Å—è –≤ —Å–≤–æ—ë–º —Ç–µ–º–ø–µ –∏ –ø–æ–ª—É—á–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç –∫—É—Ä–∞—Ç–æ—Ä–æ–≤ –≤ —á–∞—Ç–µ.\n\n\nüöÄ –ö–æ–≥–¥–∞ —è –≤–æ–∑—å–º—É –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞?\n–í—Å—ë –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç–∏. –í —Å—Ä–µ–¥–Ω–µ–º —É—á–µ–Ω–∏–∫–∏ –±–µ—Ä—É—Ç –ø–µ—Ä–≤—ã–µ –∑–∞–∫–∞–∑—ã —É–∂–µ —á–µ—Ä–µ–∑ 3‚Äì6 –Ω–µ–¥–µ–ª—å, –ø–æ—Å–ª–µ –æ—Å–≤–æ–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞ Kwork.\n\n\n‚è∞ –°–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ —É–¥–µ–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–∏ –æ–±—É—á–µ–Ω–∏—é?\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –≤—ã–¥–µ–ª—è—Ç—å —Ö–æ—Ç—è –±—ã 1‚Äì2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å. –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å ‚Äî –∫–ª—é—á –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É.\n\n\nüß© –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —è –Ω–µ –ø–æ–Ω–∏–º–∞—é –º–∞—Ç–µ—Ä–∏–∞–ª?\n–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π! –ó–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –≤ —á–∞—Ç–µ ‚Äî —Ç–µ–±–µ –ø–æ–º–æ–≥—É—Ç –∫—É—Ä–∞—Ç–æ—Ä—ã –∏ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞. –ú—ã —Ä–∞–∑–±–∏—Ä–∞–µ–º —Å–ª–æ–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ–¥—Ä–æ–±–Ω–æ –∏ –Ω–∞ –ø–æ–Ω—è—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö.\n\nüí∏ –ö–∞–∫–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ –±—É–¥–µ—Ç –ø–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –≤ Closed Team?\n–î–æ—Ö–æ–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è.\n–í —Å—Ä–µ–¥–Ω–µ–º –Ω–∞—à–∏ –≤—ã–ø—É—Å–∫–Ω–∏–∫–∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—Ç 50 000 –¥–æ 100 000‚ÇΩ –≤ –º–µ—Å—è—Ü –Ω–∞ —Ñ—Ä–∏–ª–∞–Ω—Å–µ, –≤—ã–ø–æ–ª–Ω—è—è –∑–∞–∫–∞–∑—ã –ø–æ –≤–∏–¥–µ–æ–º–æ–Ω—Ç–∞–∂—É, –¥–∏–∑–∞–π–Ω—É –∏ –∞–Ω–∏–º–∞—Ü–∏–∏.\n–ü—Ä–∏ —Ö–æ—Ä–æ—à–µ–º –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö –¥–æ—Ö–æ–¥ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 150 000‚ÇΩ –≤ –º–µ—Å—è—Ü."
    await message.answer_photo(IMAGE_URL, caption=text)

@dp.message(Command("buy"))
async def buy(message: types.Message):
    text = "üí≥ –ì–æ—Ç–æ–≤ –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ?\n\n–í—ã–±–µ—Ä–∏ —É–¥–æ–±–Ω—ã–π —Ç–∞—Ä–∏—Ñ –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –Ω–∞—à–µ–º—É —Å–æ–æ–±—â–µ—Å—Ç–≤—É –≤–∏–¥–µ–æ–º–µ–π–∫–µ—Ä–æ–≤!\n–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã —Ç—ã –ø–æ–ª—É—á–∏—à—å –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, –æ–±—É—á–∞—é—â–∏–º –º–æ–¥—É–ª—è–º –∏ —á–∞—Ç—É —Å –∫—É—Ä–∞—Ç–æ—Ä–∞–º–∏.\n\nüì© –î–ª—è –ø–æ–∫—É–ø–∫–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –æ–±—É—á–µ–Ω–∏—é ‚Äî –ø–∏—à–∏ —Å—é–¥–∞:\nüëâ @Neckfee\n–ù–∞—á–Ω–∏ –ø—É—Ç—å –≤ –≤–∏–¥–µ–æ–º–æ–Ω—Ç–∞–∂ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è üé¨"
    await message.answer_photo(IMAGE_URL, caption=text)

@dp.message(Command("subscriptions"))
async def subscriptions(message: types.Message):
    text = "üí∞ –¢–∞—Ä–∏—Ñ—ã –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ\n\n1 –º–µ—Å—è—Ü ‚Äî 1000‚ÇΩ\n6 –º–µ—Å—è—Ü–µ–≤ ‚Äî 5000‚ÇΩ\n12 –º–µ—Å—è—Ü–µ–≤ ‚Äî 10000‚ÇΩ\n–ù–∞–≤—Å–µ–≥–¥–∞ ‚Äî 15000‚ÇΩ\n\n–í—ã–±–∏—Ä–∞–π —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –æ–±—É—á–µ–Ω–∏—é!"
    await message.answer_photo(IMAGE_URL, caption=text)

@dp.message(Command("reviews"))
async def reviews(message: types.Message):
    await message.answer_photo(IMAGE_URL, caption="–°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç–∑—ã–≤—ã: https://t.me/+kO5zIxILayw0MjMy")

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–∞
async def on_startup(bot: Bot):
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –º–µ–Ω—é
    commands = [
        BotCommand(command="start", description="–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –º–µ–Ω—é"),
        BotCommand(command="questions", description="–ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã"),
        BotCommand(command="buy", description="–ö—É–ø–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ"),
        BotCommand(command="subscriptions", description="–¢–∞—Ä–∏—Ñ—ã –Ω–∞ –æ–±—É—á–µ–Ω–∏–µ"),
        BotCommand(command="reviews", description="–û—Ç–∑—ã–≤—ã"),
    ]
    await bot.set_my_commands(commands)
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–µ–±—Ö—É–∫–∞
    if WEBHOOK_HOST:
        webhook_url = WEBHOOK_URL
        await bot.set_webhook(webhook_url)
        print(f"Webhook set to: {webhook_url}")

async def on_shutdown(bot: Bot):
    # –£–¥–∞–ª–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–∞ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    await bot.delete_webhook()
    print("Webhook deleted")

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞
async def main():
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ startup/shutdown
    dp.startup.register(on_startup)
    dp.shutdown.register(on_shutdown)
    
    # –°–æ–∑–¥–∞–µ–º aiohttp –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    app = web.Application()
    
    # –°–æ–∑–¥–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–æ–≤
    webhook_requests_handler = SimpleRequestHandler(
        dispatcher=dp,
        bot=bot,
    )
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    webhook_requests_handler.register(app, path=WEBHOOK_PATH)
    
    # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    setup_application(app, dp, bot=bot)
    
    return app

if __name__ == "__main__":
    import asyncio
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
    app = asyncio.run(main())
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—Ç (Render —Å–∞–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç PORT –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é)
    port = int(os.getenv("PORT", 5000))
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
    web.run_app(app, host="0.0.0.0", port=port)